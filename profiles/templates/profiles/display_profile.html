{% extends "profiles/base.html" %}
{% load static %}

{% block title %}AGENT DOSSIER: {{ profile.in_game_name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'profiles/css/display_profile.css' %}">
{% endblock %}

{% block content %}
<div class="menu-container">
    <div class="menu-btn" onclick="this.nextElementSibling.classList.toggle('active')">
        <span class="icon">â‰¡</span>
    </div>
    <div class="menu-dropdown">
        <a href="{% url 'profile_list' %}" class="menu-item">Roster</a>
        <a href="{% url 'card_profile' profile.id %}" class="menu-item">Player Card</a>
        {% if user.is_authenticated and profile.user_id == user.id %}
        <a href="{% url 'edit_profile' profile.id %}" class="menu-item">Edit Profile</a>
        <a href="#" class="menu-item"
            onclick="if(confirm('Delete Agent {{ profile.in_game_name }}? This action is irreversible.')) document.getElementById('delete-form').submit(); return false;"
            style="color:#ff4655;">Terminate</a>
        {% endif %}
        {% if user.is_authenticated and not user.profile_id and not profile.user_id %}
        <a href="{% url 'claim_profile' profile.id %}" class="menu-item">Claim Profile</a>
        {% endif %}
    </div>
</div>

{% if profile.user_id %}
<div
    style="margin-bottom: 10px; color: #00f5ff; font-family:'Oswald', sans-serif; letter-spacing:1px; text-transform: uppercase;">
    Claimed by {{ profile.user.username }}</div>
{% else %}
<div
    style="margin-bottom: 10px; color: #ff4655; font-family:'Oswald', sans-serif; letter-spacing:1px; text-transform: uppercase;">
    Unclaimed</div>
{% endif %}

<form id="delete-form" action="{% url 'delete_profile' profile.id %}" method="post" style="display:none;">
    {% csrf_token %}
</form>

<div class="profile-header">
    {% if profile.profile_picture %}
    <img src="{{ profile.profile_picture.url }}" class="header-pfp" alt="{{ profile.in_game_name }}">
    {% else %}
    <div class="header-pfp"
        style="display:flex;align-items:center;justify-content:center;font-size:80px;background:#1f2833;">?</div>
    {% endif %}

    <div class="header-info">
        <span class="header-tag">#{{ profile.riot_tag|default:"XXXX" }}</span>
        <h1>{{ profile.in_game_name }}</h1>

        <div class="header-affiliation"
            style="display: flex; align-items: center; gap: 30px; margin-top:15px; flex-wrap: wrap;">

            {% if profile.team %}
            <div class="team-container" style="margin-top:0;">
                {% if profile.team.get_icon_url %}
                <img src="{{ profile.team.get_icon_url }}" alt="{{ profile.team.name }}" class="team-logo">
                {% endif %}
                <span class="header-team">{{ profile.team.name }}</span>
            </div>

            {% if teammates %}
            <div class="teammates-strip" style="display: flex; align-items: center; gap: 8px;">
                <span style="color: rgba(255,255,255,0.3); font-family:'Oswald'; font-size:0.9rem; margin-right:5px;">//
                    ALLIES</span>
                {% for teammate in teammates %}
                <a href="{% url 'display_profile' teammate.id %}" class="teammate-avatar"
                    title="{{ teammate.in_game_name }}">
                    {% if teammate.profile_picture %}
                    <img src="{{ teammate.profile_picture.url }}" alt="{{ teammate.in_game_name }}">
                    {% else %}
                    <span>{{ teammate.in_game_name|slice:":1" }}</span>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
            {% endif %}

            {% else %}
            <span class="header-team">FREE AGENT</span>
            {% endif %}

        </div>
    </div>
</div>

<div class="details-grid">
    <div class="left-col">
        <div class="panel">
            <div class="panel-title">Active Agents</div>
            <div class="item-grid">
                {% for agent in profile.agents.all %}
                <div class="grid-item">
                    <div class="item-icon">
                        <img src="{{ agent.get_icon_url }}" alt="{{ agent.name }}">
                    </div>
                    <div class="item-name">{{ agent.name }}</div>
                </div>
                {% empty %}
                <p style="color:#8fa1c1;">No agents assigned.</p>
                {% endfor %}
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">Map Rotation Preference</div>
            <div class="item-grid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
                {% for map in profile.maps.all %}
                <div class="grid-item">
                    <div class="item-icon" style="width:100%; height:80px;">
                        {% if map.get_icon_url %}
                        <img src="{{ map.get_icon_url }}" alt="{{ map.name }}"
                            style="width:100%; height:100%; object-fit:cover;">
                        {% endif %}
                    </div>
                    <div class="item-name">{{ map.name }}</div>
                </div>
                {% empty %}
                <p style="color:#8fa1c1;">No maps selected.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="right-col">
        <div class="panel">
            <div class="panel-title">Roles</div>
            <div class="item-grid" style="grid-template-columns: 1fr;">
                {% for role in profile.roles.all %}
                <div class="grid-item" style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                    <div class="item-icon" style="width:40px; height:40px; margin:0;">
                        {% if role.get_icon_url %}
                        <img src="{{ role.get_icon_url }}" alt="{{ role.name }}">
                        {% endif %}
                    </div>
                    <div class="item-name" style="font-size:1rem;">{{ role.name }}</div>
                </div>
                {% empty %}
                <p style="color:#8fa1c1;">No roles assigned.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    anime({
        targets: '.panel',
        translateY: [30, 0],
        opacity: [0, 1],
        delay: anime.stagger(100)
    });
</script>
{% endblock %}